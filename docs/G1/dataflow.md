# Поток данных и архитектура приложения (G1)

Здесь описан общий поток данных между основными частями системы и используемые технологии.

## 1. Общие элементы

Основные компоненты:

- Клиент (браузер):
  - UI на **React + TypeScript**;
  - состояние в **Redux Toolkit**;
  - **Web Worker** для расчёта статистики;
  - **Canvas API** для визуализации (календарь / графики).
- Сервер:
  - **Node.js + Express**, REST API.
- База данных:
  - любая реляционная (например, PostgreSQL / SQLite).
- Внешние сервисы:
  - аналитика (Google Analytics / Яндекс Метрика);
  - баг-трекер (Sentry).

---

## 2. Поток данных на клиенте

1. Пользователь взаимодействует с интерфейсом (React-компоненты).
2. Компоненты диспатчат actions в **Redux Store**.
3. Redux:
   - обновляет локальное состояние (цели, задачи, выбранный период, пользователь);
   - при необходимости вызывает побочные эффекты (запросы к backend, отправка данных в Web Worker).

---

## 3. Взаимодействие с backend

1. UI или middleware в Redux отправляет HTTP-запросы к серверу:

   - `POST /api/auth/login` — авторизация;
   - `GET /api/goals` — получить список целей;
   - `POST /api/goals` — создать цель;
   - `GET /api/tasks` — получить задачи;
   - `POST /api/tasks` — создать задачу;
   - и т.д.

2. **Node.js + Express**:
   - принимает запрос;
   - проверяет пользователя (сессия / токен);
   - читает или записывает данные в БД;
   - возвращает JSON-ответ клиенту.

3. Клиент обрабатывает ответ:
   - Redux обновляет store;
   - UI перерисовывается с новыми данными.

---

## 4. Web Worker и расчёт статистики

Чтобы не блокировать UI, тяжёлые расчёты делаются в **Web Worker**:

1. При изменении задач/целей Redux формирует структуру данных для статистики (список задач с датами и длительностями).
2. Эти данные отправляются в Web Worker (через `postMessage`).
3. Web Worker:
   - группирует задачи по дням/неделям;
   - считает суммарное время;
   - рассчитывает streak (кол-во дней подряд с учёбой);
   - возвращает результат обратно в основной поток.
4. Redux обновляет в store блок `statistics`.
5. Компоненты статистики (графики, календарь) используют эти данные для отрисовки.

---

## 5. Визуализация с помощью Canvas API

Для некоторых элементов статистики используется **Canvas API**:

- Календарь-heatmap:
  - по оси X — дни;
  - цвет ячейки зависит от количества часов в день;
  - данные приходят из Redux `statistics`.
- Дополнительные графики/индикаторы (при необходимости).

Отрисовка выполняется в React-компоненте, который управляет `<canvas>`.

---

## 6. Аналитика и мониторинг

### 6.1. Аналитика

На уровне клиента подключается, например, Google Analytics или Яндекс Метрика.  

Отправляются события:

- `goal_created` — создана учебная цель;
- `task_created` — создана задача;
- `task_completed` — задача отмечена выполненной;
- `view_statistics` — пользователь открыл страницу статистики.

Это поможет понимать, как пользователи реально используют приложение.

### 6.2. Баг-трекер

Подключается Sentry:

- клиентская часть отправляет ошибки JavaScript;
- серверная часть (Node.js) — ошибки API.

Это позволяет отслеживать падения и проблемы в реальном использовании.

---

## 7. Схема (визуально)

Схема нарисована на доске Miro: https://miro.com/app/board/uXjVGfaq0CQ=/?share_link_id=284145627989
На ней отображены блоки:

- Пользователь → UI (React)
- UI ↔ Redux Store
- Redux → Backend (Node.js API) → DB
- Redux ↔ Web Worker → Redux
- UI → Canvas API
- UI → Аналитика
- UI/Backend → Sentry

